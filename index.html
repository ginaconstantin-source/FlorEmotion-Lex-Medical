<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FlorEmotion Lex Medical | Forensic AI Suite</title>
    
    <script defer src="https://cdn.jsdelivr.net/npm/@vladmandic/face-api/dist/face-api.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Montserrat:wght@300;400;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg-medical: #F9F7F2;  /* Crem pal */
            --white: #FFFFFF;
            --gold: #B08D57;       /* Auriu mat Lex */
            --text-dark: #2C3E50;
            --accent-blue: #E8F0FE;
        }

        body { 
            font-family: 'Montserrat', sans-serif; 
            background-color: var(--bg-medical); 
            color: var(--text-dark); 
            margin: 0; 
            line-height: 1.8; 
        }

        /* HEADER */
        header {
            background-color: var(--white);
            padding: 30px 8%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid var(--gold);
            position: sticky; top: 0; z-index: 1000;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
        }
        .logo h1 { font-family: 'Cinzel', serif; color: var(--gold); margin: 0; font-size: 1.8rem; letter-spacing: 2px; }

        /* GRID ANALIZƒÇ */
        .main-container { 
            display: grid; 
            grid-template-columns: 1.2fr 0.8fr; 
            gap: 60px; 
            padding: 80px 8%; 
            max-width: 1500px; 
            margin: 0 auto; 
        }
        
        .box { 
            background: var(--white); 
            padding: 50px; 
            border-radius: 15px; 
            border: 1px solid #e0e0e0; 
            box-shadow: 0 10px 40px rgba(0,0,0,0.03); 
        }

        .visual-panel { border-top: 8px solid var(--gold); position: relative; }
        
        /* DISPLAY AREA CU SIMBOL STATIC */
        .display-area { 
            width: 100%; 
            height: 550px; 
            background: #f4f4f4; 
            position: relative; 
            border-radius: 10px; 
            overflow: hidden; 
            display: flex; 
            align-items: center; 
            justify-content: center;
            border: 1px solid #ddd;
        }

        /* Simbolul static juridic-medical */
        .static-symbol {
            position: absolute;
            font-size: 8rem;
            color: var(--gold);
            opacity: 0.15;
            z-index: 1;
        }

        video, canvas, #image-preview { position: absolute; width: 100%; height: 100%; object-fit: cover; z-index: 2; }

        .verdict-panel { text-align: center; }
        .main-emotion { 
            font-family: 'Cinzel'; 
            font-size: 2.5rem; 
            font-weight: bold; 
            background: var(--accent-blue); 
            padding: 30px; 
            margin: 30px 0; 
            border-radius: 10px; 
            color: var(--gold);
            box-shadow: inset 0 0 15px rgba(176, 141, 87, 0.1);
        }

        .bar-container { margin-bottom: 25px; text-align: left; }
        .bar-header { display: flex; justify-content: space-between; font-size: 0.95rem; font-weight: 700; margin-bottom: 8px; }
        .bar-outer { background: #eee; height: 16px; border-radius: 8px; overflow: hidden; }
        .bar-inner { height: 100%; width: 0%; background: var(--gold); transition: width 0.8s ease-out; }

        .btn { 
            background: var(--gold); 
            color: white; 
            padding: 22px 40px; 
            border: none; 
            font-weight: 800; 
            cursor: pointer; 
            width: 100%; 
            border-radius: 8px; 
            margin-top: 15px; 
            text-transform: uppercase; 
            letter-spacing: 1px;
            font-size: 1rem;
            transition: 0.3s;
        }
        .btn:hover { background: #8e6a3d; }

        /* SECTIUNI ADITIONALE PENTRU LUNGIME SI DESIGN */
        .section-title { text-align: center; font-family: 'Cinzel', serif; color: var(--gold); font-size: 2.2rem; margin: 80px 0 40px; }
        .medici-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 30px; padding: 0 8%; }
        .medic-card { background: var(--white); padding: 40px; border-radius: 15px; border-bottom: 5px solid var(--gold); text-align: center; box-shadow: 0 5px 20px rgba(0,0,0,0.05); }
        .medic-card i { font-size: 3rem; color: var(--gold); margin-bottom: 20px; }

        .form-section { background: var(--accent-blue); padding: 80px 8%; margin-top: 80px; }
        .form-container { max-width: 900px; margin: 0 auto; background: var(--white); padding: 50px; border-radius: 15px; border: 1px solid var(--gold); }
        input, select, textarea { width: 100%; padding: 15px; margin-top: 10px; border: 1px solid #ddd; border-radius: 5px; }

        #loader { 
            position: absolute; z-index: 100; background: rgba(255,255,255,0.95); 
            width: 100%; height: 100%; display: flex; flex-direction: column; 
            align-items: center; justify-content: center; color: var(--gold); font-weight: bold; 
        }

        @media print { .no-print { display: none !important; } }
    </style>
</head>
<body>

<header class="no-print">
    <div class="logo"><h1>FLOREMOTION <span>LEX MEDICAL</span></h1></div>
    <div style="font-size: 0.9rem; font-weight: bold; color: var(--text-dark);">MEDIC LEGIST: CONSTANTIN GINA FLORENTINA</div>
</header>

<main class="main-container no-print">
    <section class="box visual-panel">
        <h3 style="font-family: 'Cinzel'; color: var(--gold); margin-bottom: 30px;">SISTEM DE ANALIZƒÇ NEURONALƒÇ</h3>
        <div class="display-area" id="drop-zone">
            <i class="fas fa-gavel static-symbol"></i> 
            
            <div id="loader">
                <i class="fas fa-brain fa-spin fa-3x"></i>
                <p style="margin-top: 20px;">Se √ÆncarcƒÉ re»õelele neuronale VGG-Face...</p>
            </div>
            <video id="webcam" autoplay muted playsinline></video>
            <img id="image-preview" style="display:none;">
            <canvas id="overlay"></canvas>
        </div>
        <p style="font-size: 0.9rem; color: #7f8c8d; margin-top: 25px;">
            <i class="fas fa-microchip"></i> Tehnologie Machine Learning pentru expertizƒÉ biometricƒÉ bazatƒÉ pe modelul VGG-Face.
        </p>
    </section>

    <section class="box verdict-panel">
        <h3 style="font-family: 'Cinzel'; color: var(--gold);">VERDICT BIOMETRIC</h3>
        <div id="main-emo" class="main-emotion">STANDBY</div>
        <div id="results-root">
            </div>
        
        <div style="margin-top: 40px;">
            <button class="btn" onclick="document.getElementById('file-upload').click()">üì• √éncarcƒÉ ProbƒÉ (FOTO)</button>
            <input type="file" id="file-upload" style="display:none" accept="image/*" onchange="processImage(this)">
            <button class="btn" style="background:transparent; border:2px solid var(--gold); color:var(--gold); margin-top:15px;" onclick="window.print()">‚öñÔ∏è GenereazƒÉ Raport Judiciar</button>
        </div>
    </section>
</main>

<h2 class="section-title">Consiliul de Exper»õi Medicali</h2>
<div class="medici-grid">
    <div class="medic-card">
        <i class="fas fa-user-md"></i>
        <h3>Dr. Constantin Gina Florentina</h3>
        <p style="color: var(--gold); font-weight: bold;">Medic Legist - Coordonator</p>
        <p>Expertize biometrice neuronale.</p>
    </div>
    <div class="medic-card">
        <i class="fas fa-brain"></i>
        <h3>Dr. Elena Vance</h3>
        <p style="color: var(--gold); font-weight: bold;">Medic Neurolog</p>
        <p>Analiza reac»õiilor afective involuntare.</p>
    </div>
</div>

<section class="form-section no-print">
    <div class="form-container">
        <h3 style="font-family: 'Cinzel'; color: var(--gold); text-align: center; margin-bottom: 30px;">ProgrameazƒÉ o ExpertizƒÉ / Trimite Raport</h3>
        <form>
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div>
                    <label style="font-weight: bold; color: var(--gold);">Nume Complet Subiect</label>
                    <input type="text" placeholder="Numele subiectului...">
                </div>
                <div>
                    <label style="font-weight: bold; color: var(--gold);">Telefon Contact</label>
                    <input type="text" placeholder="07xx xxx xxx">
                </div>
            </div>
            <div style="margin-top: 20px;">
                <label style="font-weight: bold; color: var(--gold);">Medic Destinatar</label>
                <select>
                    <option>Dr. Constantin Gina Florentina</option>
                    <option>Dr. Elena Vance</option>
                </select>
            </div>
            <div style="margin-top: 20px;">
                <label style="font-weight: bold; color: var(--gold);">Observa»õii / Context Juridic</label>
                <textarea rows="4" placeholder="Detalii relevante..."></textarea>
            </div>
            <button type="button" class="btn">Trimite Cererea spre Validare</button>
        </form>
    </div>
</section>

<footer style="text-align: center; padding: 50px; background: var(--white); border-top: 1px solid var(--gold); margin-top: 50px;">
    <p>¬© 2026 FLOREMOTION LEX MEDICAL | SISTEM DE EXPERTIZƒÇ BIOMETRICƒÇ PROTEJAT</p>
</footer>

<script>
    const video = document.getElementById('webcam');
    const canvas = document.getElementById('overlay');
    const imgPreview = document.getElementById('image-preview');
    const mainEmoLabel = document.getElementById('main-emo');
    const resultsRoot = document.getElementById('results-root');
    const loader = document.getElementById('loader');

    const emoRo = { 
        happy: "Bucurie", sad: "Triste»õe", angry: "Furie", 
        fearful: "FricƒÉ", disgusted: "Dezgust", surprised: "SurprizƒÉ", neutral: "Neutru" 
    };

    // 1. √éncƒÉrcare Re»õele Neuronale
    async function startSystem() {
        const MODEL_URL = 'https://cdn.jsdelivr.net/npm/@vladmandic/face-api/dist/model/';
        try {
            await faceapi.nets.tinyFaceDetector.loadFromUri(MODEL_URL);
            await faceapi.nets.faceExpressionNet.loadFromUri(MODEL_URL);
            await faceapi.nets.faceLandmark68Net.loadFromUri(MODEL_URL);
            
            loader.style.display = 'none';
            initWebcam();
        } catch (e) {
            loader.innerHTML = "<p>Eroare: Modelele AI nu au putut fi descƒÉrcate.</p>";
        }
    }

    function initWebcam() {
        navigator.mediaDevices.getUserMedia({ video: {} }).then(stream => {
            video.srcObject = stream;
            video.onloadedmetadata = () => {
                const displaySize = { width: video.offsetWidth, height: video.offsetHeight };
                faceapi.matchDimensions(canvas, displaySize);
                
                setInterval(async () => {
                    if(imgPreview.style.display === 'none') {
                        const detections = await faceapi.detectAllFaces(video, new faceapi.TinyFaceDetectorOptions()).withFaceExpressions();
                        updateResults(detections, displaySize);
                    }
                }, 400);
            };
        }).catch(() => {
            loader.style.display = 'flex';
            loader.innerHTML = "<p>Webcam inactiv. VƒÉ rugƒÉm √ÆncƒÉrca»õi o probƒÉ foto.</p>";
        });
    }

    // 2. LOGICA PENTRU IMAGINI (OptimizatƒÉ pentru detec»õie instantanee)
    async function processImage(input) {
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = async (e) => {
                // Afi»ôƒÉm imaginea pe ecran
                imgPreview.src = e.target.result;
                imgPreview.style.display = 'block';
                video.style.display = 'none';
                
                // ProcesƒÉm imaginea prin Machine Learning
                const img = await faceapi.fetchImage(e.target.result);
                const detections = await faceapi.detectAllFaces(img, new faceapi.TinyFaceDetectorOptions()).withFaceExpressions();
                
                // ActualizƒÉm rezultatele imediat
                updateResults(detections, { width: video.offsetWidth, height: video.offsetHeight });
            };
            reader.readAsDataURL(input.files[0]);
        }
    }

    // 3. Afi»ôare rezultate Biometrice
    function updateResults(detections, size) {
        if (detections.length > 0) {
            const expressions = detections[0].expressions;
            const sorted = Object.entries(expressions).sort((a,b) => b[1]-a[1]);
            
            mainEmoLabel.innerText = emoRo[sorted[0][0]].toUpperCase();
            
            resultsRoot.innerHTML = '';
            sorted.forEach(([key, val]) => {
                const percent = (val * 100).toFixed(1);
                resultsRoot.innerHTML += `
                    <div class="bar-container">
                        <div class="bar-header"><span>${emoRo[key]}</span><span>${percent}%</span></div>
                        <div class="bar-outer"><div class="bar-inner" style="width: ${percent}%"></div></div>
                    </div>`;
            });
        }
    }

    startSystem();
</script>

</body>
</html>
